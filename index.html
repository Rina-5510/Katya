<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Расписание</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: black;
        overflow-y: hidden
      }
      .scroll-container {
        width: 100vw;
        height: 100vh;
        overflow-x: auto;
        white-space: nowrap;
        position: relative;
      }
      .content {
        display: inline-block;
        width: 300vw;
        height: 100%;
      }
      .fixed-nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        padding-top: 3vh;
        padding-bottom: 3vh;
        text-align: center;
        z-index: 10;
      }
      .button {
        margin: 0;
        padding: 0;
        width: 8vw;
        color: white;
        border: none;
        background: transparent;
        font-size: 16px;
      }
      .timeline {
        width: 180%;
        height: 8px;
        background-color: rgba(255, 255, 255, 0.3);
        position: relative;
        left: 1vw;
      }
      .moving-line {
        position: absolute;
        width: 6px;
        height: 120px;
        background: linear-gradient(
          rgba(0, 0, 0, 0),
          red,
          rgba(0, 0, 0, 0));
        top: -51px;
        z-index: 3;
        opacity: 0.6;
      }
      .container {
        width: 180%;
        position: relative;
        height: 15vh;
        top: 45vh;
      }
      .marker {
        position: absolute;
        bottom: -37px;
        width: 2px;
        height: 80px;
        background: linear-gradient(
          rgba(0, 0, 0, 0),
          rgba(255, 255, 255, 0.4),
          rgba(0, 0, 0, 0));
      }
      .hour-marker {
        position: absolute;
        bottom: -83px;
        width: 2px;
        height: 180px;
        background: linear-gradient(
          rgba(0, 0, 0, 0),
          rgba(255, 255, 255, 0.4),
          rgba(0, 0, 0, 0));
      }
      .hour-label {
        position: absolute;
        bottom: 66px;
        left: 3vw;
        font-size: 18px;
        color: #e1e1e1;
        text-align: center;
      }
      .hour-label-other {
        position: absolute;
        bottom: -81px;
        font-size: 18px;
        color: #e1e1e1;
        text-align: center;
      }
      .event {
        position: absolute;
        padding-top: 6px;
        padding-bottom: 6px;
        border-radius: 3px;
        text-align: center;
        font-size: 15px;
        z-index: 1;
        width: 150%;
        color: white;
      }
/* Стили для уроков Кати */
      .event.type1 {
        background-color: rgba(62, 88, 229, 0.6);
        top: -43px;
      }
/* Стили для уроков Рустама */
      .event.type2 {
        background-color: rgba(0, 126, 91, 0.6);
        top: -12px;
      }
/* Стили для уроков Насти */
      .event.type5 {
        background-color: rgba(232, 80, 87, 0.6);
        top: 19px;
      }
/* Стили для столовой */
      .event.type3 {
        padding: 0;
        background-color: rgba(245, 182, 31, 0.4);
        height: 19px;
        top: -43px;
      }
      .event.type4 {
        padding: 0;
        background-color: rgba(245, 182, 31, 0.4);;
        height: 19px;
        top: -12px;
      }
      .event.type6 {
        padding: 0;
        height: 19px;
        background-color: rgba(245, 182, 31, 0.4);
        top: 21px;
        }
      @media (orientation: portrait) {
        .hour-label {
          font-size: 15px;
        }
        .hour-label-other {
          font-size: 15px;
        }
        .container {
          width: 280%;
        }
        .fixed-nav {
          padding-top: 3vh;
          padding-bottom: 3vh;
        }
        .button {
          width: 8vw;
        }
      }
    </style>
  </head>
  <div id="modal">
    <div id="buttons-container">
      <button class="button" onclick="setDay(1);">пн</button>
      <button class="button" onclick="setDay(2);">вт</button>
      <button class="button" onclick="setDay(3);">ср</button>
      <button class="button" onclick="setDay(4);">чт</button>
      <button class="button" onclick="setDay(5);">пт</button>
      <button class="button" onclick="setDay(6);">сб</button>
      <button class="button" onclick="setDay(0);">вс</button>
    </div>
  </div>
  <body>
    <div class="fixed-nav">
      <button id="one" class="button" onclick="setDay(1);">пн</button>
      <button id="two" class="button" onclick="setDay(2);">вт</button>
      <button id="three" class="button" onclick="setDay(3);">ср</button>
      <button id="four" class="button" onclick="setDay(4);">чт</button>
      <button id="five" class="button" onclick="setDay(5);">пт</button>
      <button id="six" class="button" onclick="setDay(6);">сб</button>
      <button id="zero" class="button" onclick="setDay(0);">вс</button>
    </div>
    
    <div class="scroll-container">
      <div class="content">
        <div class="container">
          <div class="timeline" id="timeline"></div>
          <div class="moving-line" id="movingLine"></div>
        </div>
      </div>
    </div>
    <script src="index.js"></script>
    <script>
      const timeZoneOffset = -5;
      const otherTimeZoneOffset = -7;
      const stepMinutes = 10;
      const stepHours = 60;
      const timeline = document.getElementById('timeline');
      createModal('modal', 'buttons-container');
      
const millisecondsInDay = 24 * 60 * 60 * 1000;
const startOfDay = new Date().setHours(0, 0, 0, 0);         
        function displayEvents(day = 0) {
            const timeline = document.querySelector('.timeline');
            const timelineWidth = timeline.offsetWidth;
             
            const existingEvents = timeline.querySelectorAll('.event');
            existingEvents.forEach(event => event.remove());
            const currentDay = day == 0 ? new Date().getDay() : day;
            eventsByDay[currentDay].forEach(event => {                
                const eventElement = document.createElement('div');
                eventElement.classList.add('event');
                eventElement.classList.add(event.type);
                eventElement.style.left = ((((new Date(event.time)) - startOfDay) / millisecondsInDay) * timelineWidth) + 'px';                               
                eventElement.style.width = ((event.duration / millisecondsInDay) * timelineWidth) + 'px';
                eventElement.textContent = event.label;
                timeline.appendChild(eventElement);
            });
        }
        function renderTimeMarkers() {
            const existingMarkers = document.querySelectorAll('.marker, .hour-marker, .hour-label, .hour-label-other');
            existingMarkers.forEach(marker => marker.remove());
            const width = timeline.offsetWidth;            
            const totalSteps = (24 * 60) / stepMinutes;
            for (let i = 0; i < totalSteps; i++) {
                const marker = document.createElement('div');
                marker.classList.add('marker');
                marker.style.left = (i * (width / totalSteps)) + 'px';
                timeline.appendChild(marker);
            }
            for (let i = 0; i < 24; i++) {
                const hourMarker = document.createElement('div');
                hourMarker.classList.add('hour-marker');
                const position = (i * (width / 24));
                hourMarker.style.left = `${position}px`;
                const hourLabel = document.createElement('div');
                hourLabel.classList.add('hour-label');
                hourLabel.textContent = `${i < 10 ? '0' : ''}${i}:00`;
                hourLabel.style.left = `${position}px`;
                const hourLabelOther = document.createElement('div');
                hourLabelOther.classList.add('hour-label-other');
                const adjustedHour = (i + (otherTimeZoneOffset - timeZoneOffset) + 24) % 24;
                hourLabelOther.textContent = `${adjustedHour < 10 ? '0' : ''}${adjustedHour}:00`;
                hourLabelOther.style.left = `${position}px`;
                timeline.appendChild(hourMarker);
                timeline.appendChild(hourLabel);
                timeline.appendChild(hourLabelOther);
            }
        }
        const movingLine = document.getElementById('movingLine');
        function updateMovingLines() {
            const now = new Date();
            const localTime = new Date(now.toLocaleString('en-US', { timeZone: `Etc/GMT${timeZoneOffset >= 0 ? '+' : '-'}${Math.abs(timeZoneOffset)}`}));
            const otherTime = new Date(now.toLocaleString('en-US', { timeZone: `Etc/GMT${otherTimeZoneOffset >= 0 ? '+' : '-'}${Math.abs(otherTimeZoneOffset)}` }));
            const startOfDayLocal = new Date(localTime).setHours(0, 0, 0, 0);           
            movingLine.style.left = (((localTime - startOfDayLocal) / millisecondsInDay) * (document.querySelector('.timeline').offsetWidth)) + 'px';
        }
        function handleResize() {
            displayEvents();
            updateMovingLine();
        }
        function setDay(day){
           renderTimeMarkers();
           displayEvents(day);
            updateMovingLine();
        }
           function createModal(modalId, contentId){
  var modalStatusClick = function(modal, modalId){
   };
   var content = document.getElementById(contentId); 
   var modal = document.getElementById(modalId);
   var close = document.createElement('span');
   close.id = 'close';
   close.textContent = '×';  
   close.style.cssText = `
    color: #B00000;
    float: right;
    font-size: 28px;
    font-weight: bold;
    margin-top: -2%;
   `;
   const setContentSize = function(){
    if(window.innerWidth > window.innerHeight){
     content.style.cssText = `
     background-color: #323338;
     margin: auto;
     padding: 20px;
     width: 20vw;
     height: 10vh;
     border-radius: 25px;
     text-align: center;
     `;
    }
    else{
    content.style.cssText = `
     width: 30vw;
     height: 6vh;
     background-color: #323338;
     margin: auto;
     padding: 20px;  
     border-radius: 25px;
     text-align: center;
    `;
    }
   };
   setContentSize();
   window.onresize = function(){
     setContentSize();
  };
   modal.style.cssText = `
    display: none; 
    position: fixed;
    z-index: 1000;
    width: 10vw;
    height: 10vh;    
   `;
    content.prepend(close);           
  let el = document.getElementById(modalId).style;   
    document.onclick = function(event){       
    el.display = 'block';
    el.left = event.offsetX + 'px';
    el.top = event.offsetY + 'px';
    };
    document.getElementById('close').onclick = function(){   
    document.getElementById(modalId).style.display = 'none';
    };
 }
    function setFont(setDay) {
      const oneElement = document.getElementById('1')
      const twoElement = document.getElementById('2')
      const threeElement = document.getElementById('3')
      const fourElement = document.getElementById('4')
      const fiveElement = document.getElementById('5')
      const sixElement = document.getElementById('6')
      const zeroElement = document.getElementById('0')
      if (setDay === 1) {
        oneElement.style.fontWeight = 'bold';
      } else {
        oneElement.style.fontWeight = 'normal';
      }
      if (setDay === 2) {
        twoElement.style.fontWeight = 'bold';
      } else {
        twoElement.style.fontWeight = 'normal';
      }
      if (setDay === 3) {
        threeElement.style.fontWeight = 'bold';
      } else {
        threeElement.style.fontWeight = 'normal';
      }
      if (setDay === 4) {
        fourElement.style.fontWeight = 'bold';
      } else {
        fourElement.style.fontWeight = 'normal';
      }
      if (setDay === 5) {
        fiveElement.style.fontWeight = 'bold';
      } else {
        fiveElement.style.fontWeight = 'normal';
      }
      if (setDay === 6) {
        sixElement.style.fontWeight = 'bold';
      } else {
        sixElement.style.fontWeight = 'normal';
      }
      if (setDay === 0) {
        zeroElement.style.fontWeight = 'bold';
      } else {
        zeroElement.style.fontWeight = 'normal';
      }
    }
      
        window.addEventListener('resize', function() {
            renderTimeMarkers();
            updateMovingLines();
        });
        window.addEventListener('resize', handleResize);
        displayEvents();
        renderTimeMarkers();
        setInterval(updateMovingLines, 1000);
        updateMovingLines();
    </script>
</body>
</html>
